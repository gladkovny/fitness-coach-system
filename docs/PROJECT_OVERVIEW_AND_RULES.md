# Что я знаю о проекте, методе его создания и ключевых правилах

Краткая сводка для контекста AI и новых участников.

> **Обновлено:** 31.01.2026 — объединены правила из cursorrules v2, добавлены частые задачи, ошибки, ссылки на Project Rules (.cursor/rules/).

---

## 1. О проекте

**Название:** Fitness Coach System  

**Суть:** Коробочная SaaS-система для персональных фитнес-тренеров. Единый центр данных о клиентах, трекинг тренировок, дашборды, онбординг. Планируются интеграции (Whoop, Apple Health) и AI-помощник.

**Владелец:** Николай (не программист, работает с AI — Cursor, Claude). Ответы должны быть простыми, с указанием раздела и контура, рисками и планом проверки.

**Клиенты системы:** Марк (hybrid, 90 дней), Ярослав (offline, Split), Кирилл (offline, Fullbody), Алёна (тест онбординга).

**Текущий этап:** Миграция с Google Apps Script + Google Sheets на Supabase. Вход и дашборд тренера уже на Supabase; трекер подключён к Supabase; дашборд и программа Марка пока на GAS.

---

## 2. Метод создания проекта

### Изначально

- **Backend:** Google Apps Script (GAS) — Master API, online API для Марка, онбординг.
- **Database:** Google Sheets (Coach Master, листы по клиентам).
- **Frontend:** Vanilla HTML/CSS/JS, без фреймворков. Исходники в `src/`, готовые к выкладке — в `deploy/master` и `deploy/mark`.
- **Hosting:** Netlify (статический хостинг).

### Сейчас (переходный период)

- **Контур Master (основной):** Supabase (PostgreSQL, Auth, RLS). Фронт: `deploy/master` — login, dashboard, tracker. Данные и вход через Supabase.
- **Контур Mark (legacy):** Дашборд и программа Марка в `deploy/mark`, данные из GAS и отдельной таблицы/скрипта.
- **Миграция данных:** GAS-скрипт `MigrateToSupabase.gs` переносит тренера, клиентов, упражнения, программы, блоки, сессии в Supabase.
- **Деплой:** Папки `deploy/master` и `deploy/mark` выкладываются как статика (Netlify/Vercel). В корне есть `netlify.toml` с `publish = "deploy/master"`.

### Целевая архитектура

Описана в `docs/ARCHITECTURE_V2.md`: Supabase (БД, Auth, Edge Functions), фронт — React PWA, дизайн Olympus, интеграции и монетизация по фазам.

---

## 3. Ключевые правила создания и изменения проекта

### 3.1. Главный принцип

**Объясняй просто, показывай где работаешь, проверяй перед изменениями.**

При любом изменении кода обязательно:
1. Указывать затронутые **разделы системы [1]–[7]**.
2. Указывать **контур** (Master/Supabase или Mark/GAS).
3. Объяснять **риски** простым языком.
4. Давать **чёткий план проверки** (чек-лист и при необходимости откат).

---

### 3.2. Ограничение сложности задач

**Сложные задачи делить на маленькие этапы и делать изменения постепенно.**

- Не брать в одну сессию крупный рефакторинг или много файлов сразу — это перегружает среду (Cursor/процессор) и повышает риск ошибок.
- Сложную задачу разбить на шаги: сначала описать план этапов, затем выполнять по одному этапу за раз, после каждого — проверка (и при необходимости коммит).
- Один этап = одна логическая порция изменений (один файл или одна функция/фича), чтобы можно было проверить и при необходимости откатить.
- Если задача большая — предложить разбиение на подзадачи и спросить, с какого этапа начать.

---

### 3.3. Семь разделов системы

| Раздел | Что это |
|--------|---------|
| [1] FRONTEND | Интерфейс (HTML, CSS, JS) |
| [2] BACKEND | Supabase / GAS |
| [3] DATABASE | Supabase PostgreSQL / Google Sheets |
| [4] AUTHENTICATION | Supabase Auth |
| [5] PAYMENTS | Не реализовано |
| [6] SECURITY | RLS, шифрование |
| [7] INFRASTRUCTURE | Netlify, Supabase, GitHub |

При изменениях всегда помечать затронутые разделы.

---

### 3.4. Два контура данных

- **Master (Supabase):** `deploy/master` — login, dashboard, tracker. Данные в Supabase. Основной контур.
- **Mark (GAS):** `deploy/mark` — дашборд Марка, программа тренировок. Данные в Google Sheets + Master API.

При изменениях всегда указывать контур.

---

### 3.5. Формат ответов при изменении кода

- **РАЗДЕЛЫ:** перечислить [1]–[7].
- **КОНТУР:** Master (Supabase) или Mark (GAS).
- **ЧТО МЕНЯЕТСЯ:** кратко список изменений.
- **РИСКИ:** по разделам (низкий/средний/высокий/критический) и причина.
- **ПРОВЕРИТЬ ПОСЛЕ:** чек-лист (что проверить вручную или в браузере).
- **ОТКАТ:** что сделать, если что-то сломается.

---

### 3.6. Правила кода

- **Комментарии:** русский язык.
- **Переменные:** английский, camelCase.
- **Константы:** UPPER_SNAKE_CASE.
- **Даты:** ISO (YYYY-MM-DD).
- **Кодировка:** UTF-8.
- Mobile-first, минимум зависимостей.
- **HTML:** семантические теги (header, main, section); min touch target 44px.
- **CSS:** использовать переменные (--bg, --accent), не хардкодить цвета.

---

### 3.7. Безопасность

- Не хранить секреты и ключи в коде; использовать конфиг (например `supabase-config.js`) или переменные окружения.
- Не удалять данные без подтверждения пользователя.
- Всегда обрабатывать ошибки при запросах к Supabase (проверять `error`, логировать, показывать пользователю сообщение).
- Не коммитить `.env` и секреты.

---

### 3.9. Когда спрашивать подтверждение

- Удаление данных.
- Изменение схемы БД (миграции).
- Изменение RLS-политик.
- Переключение контура (с GAS на Supabase) — убедиться, что новый путь работает.
- Действия, влияющие на production/реальных пользователей.

---

### 3.10. Context7

При задачах, связанных с Supabase JavaScript, Chart.js, RLS, Edge Functions или другими внешними библиотеками — автоматически использовать Context7 MCP для актуальной документации. Правило: `.cursor/rules/context7-auto.mdc` (alwaysApply). См. `docs/CONTEXT7_SETUP.md`.

---

### 3.11. Low-resource (ограничение нагрузки)

Правило `.cursor/rules/low-resource-agent.mdc` — дробить большие задачи, не перегружать систему. При массовых операциях — сначала план по шагам, затем по частям.

---

### 3.12. Синхронизация после изменений

- Проверить локально (например Live Server или `npx serve deploy/master -l 3000`).
- При изменении фронта — при необходимости синхронизировать `src/` с `deploy/master` или `deploy/mark`.
- Закоммитить с осмысленным сообщением (можно с префиксом разделов, например `[1][2] Описание`).
- При смене этапа или статуса — обновить `docs/SYNC_STATUS.md`.

---

## 4. Ключевые файлы и документы

| Файл | Назначение |
|------|------------|
| `docs/SYNC_STATUS.md` | Текущий этап и статус, что сделано и что дальше |
| `docs/cursorrules_v2.1.md` | Полные правила для Cursor (7 разделов, контуры, формат, риски, откат) |
| `docs/CLAUDE_RULES_V2.1.md` | Правила для Claude, детали по разделам |
| `docs/CURRENT_STATE_v5.md` | Общее состояние проекта, API, тестирование |
| `supabase/ИНСТРУКЦИЯ_ПЕРВЫЙ_РАЗ.md` | Первый запуск, архитектура Марка vs офлайн |
| `docs/DEPLOY.md` | Как выложить сайты (Netlify, Vercel) |
| `docs/ARCHITECTURE_V2.md` | Целевая архитектура и roadmap |
| `docs/DEPLOY.md` | Как выложить на Netlify/Vercel |
| `docs/GIT_WORKFLOW.md` | Когда коммитить, скрипт git-push.ps1 |
| `docs/CONTEXT7_SETUP.md` | Настройка Context7 MCP |
| `docs/DASHBOARD_UPGRADE_PLAN.md` | План muscleLoad, exerciseProgress |
| `.cursorrules` | Краткая ссылка на правила |

---

## 5. Структура проекта (кратко)

```
deploy/master/   — сайт тренера (Supabase): login, dashboard, tracker
deploy/mark/     — сайт Марка (GAS): dashboard, program
src/             — исходники (синхронизировать с deploy при изменениях)
supabase/        — миграции, функции, инструкции
gas/             — Google Apps Script (legacy)
docs/            — документация и правила
.cursor/rules/   — Project Rules (context7-auto, low-resource-agent)
.cursor/mcp.json — Context7 MCP (API ключ)
```

---

## 6. Частые задачи

| Задача | Как делать |
|--------|------------|
| Добавить страницу | Создать в `src/` или `deploy/master/`, подключить `common.css`, `api.js`, `supabase-config.js` |
| Изменить стили | Общие → `css/common.css`, специфичные → в компоненте |
| Добавить endpoint GAS | `gas/Master API_assessment.gs` → switch + функция |
| Supabase-запрос | Context7 → актуальный синтаксис; проверить RLS |

---

## 7. Частые ошибки

| Ошибка | Причина | Решение |
|--------|---------|---------|
| Кракозябры | Неверная кодировка | Пересохранить UTF-8 |
| Git: execution policy | PowerShell блокирует скрипты | `Set-ExecutionPolicy RemoteSigned -Scope CurrentUser` |
| Git: user.name/email | Не настроены | `git config --global user.name "..."` и `user.email "..."` |
| API/Supabase не отвечает | CORS, неверный URL | Проверить через HTTP (Live Server), не file:// |
| Стили не применяются | Кэш браузера | Ctrl+Shift+R |
