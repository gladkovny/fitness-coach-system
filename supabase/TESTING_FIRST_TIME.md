# Первый раз: пошаговое тестирование этапа «Вход + Дашборд из Supabase»

Инструкция для первого запуска: что открыть, в каком порядке, что должно получиться и что проверить.

---

## Что у тебя уже есть на этом этапе

- **Supabase** — облачная база и авторизация (проект создан, миграции применены, данные перенесены).
- **Локальные файлы** — страница входа и дашборд в папке `deploy/master/` (HTML + JS), они обращаются к Supabase по ссылке и ключу из конфига.

Цель теста: убедиться, что по логину открывается дашборд, список клиентов подтягивается из Supabase, выбор клиента показывает его данные, а без входа дашборд не открывается.

---

## Подготовка (один раз)

### Шаг 0.1. Убедиться, что в Supabase есть пользователь для входа

1. Зайди в **Supabase Dashboard**: https://supabase.com/dashboard  
2. Выбери проект **fitness-coach-system** (или как он у тебя назван).  
3. В левом меню открой **Authentication** → **Users**.  
4. Проверь: есть ли пользователь с твоим email (например `gladkovny@gmail.com`).  
   - Если **нет** — создай: кнопка **Add user** → введи email и пароль → запомни пароль.  
   - Если **есть** — пароль ты задавал при создании; если забыл — можно сбросить или создать нового пользователя.

Этот email и пароль понадобятся на странице входа.

---

### Шаг 0.2. Проверить, что тренер в БД привязан к этому пользователю

1. В Supabase в левом меню открой **Table Editor** → таблица **trainers**.  
2. Найди строку с твоим email.  
3. В колонке **auth_id** должно быть значение (UUID).  
   - Если **auth_id пустой** — привяжи вручную:  
     - Зайди **Authentication** → **Users** → скопируй **id** (UUID) нужного пользователя.  
     - В **SQL Editor** выполни (подставь свой email и скопированный id):

```sql
UPDATE trainers
SET auth_id = 'СЮДА_ВСТАВЬ_UUID_ИЗ_AUTH_USERS'
WHERE email = 'твой_email@gmail.com';
```

Без этой привязки после входа список клиентов не появится (RLS отфильтрует по `auth_id`).

---

### Шаг 0.3. Проверить конфиг фронта

1. В проекте открой файл **`deploy/master/js/supabase-config.js`**.  
2. Должны быть две строки:
   - `window.SUPABASE_URL = 'https://aobnfwvjmnbwdytagqyl.supabase.co';`  
     (или твой Project URL из Supabase → **Project Settings** → **API** → **Project URL**)
   - `window.SUPABASE_ANON_KEY = 'eyJ...';`  
     (это **anon public** ключ из того же экрана **API** → **Project API keys** → **anon public**)

Если подставлял свои URL и ключ раньше — просто убедись, что они актуальные и без лишних пробелов/кавычек.

---

## Запуск и тестирование по шагам

### Шаг 1. Запустить локальный сервер

Страницы нужно открывать не двойным щелчком по файлу (тогда в адресной строке будет `file://...`), а через локальный сервер — иначе браузер может блокировать запросы к Supabase.

1. Открой **терминал** (в Cursor: меню **Terminal** → **New Terminal**, или PowerShell/cmd).  
2. Перейди в **корень проекта** (папка `fitness-coach-system`):

   ```bash
   cd C:\Users\n.gladkov\Desktop\fitness-coach-system
   ```

3. Запусти раздачу папки `deploy/master` на порт 3000.

   **Вариант А — через Node.js (если установлен):**

   ```bash
   npx serve deploy/master -l 3000
   ```

   При первом запуске может спросить установить пакет `serve` — ответь **y** (yes).

   **Вариант Б — если команда `npx` не найдена (Node.js не установлен):**

   Используй встроенный сервер Python. В терминале выполни по очереди:

   ```powershell
   cd deploy\master
   python -m http.server 3000
   ```

   Если команда `python` не сработает, попробуй `py -m http.server 3000`.  
   В консоли должно появиться сообщение вроде: `Serving HTTP on :: port 3000 ...`

   **Вариант В — если ни `npx`, ни `python`/`py` не найдены:**

   Можно попробовать открыть страницу **без сервера** (иногда Supabase с anon-ключом отвечает и с `file://`):
   - В проводнике открой папку `deploy\master` и **дважды щёлкни** по `login.html` (откроется в браузере).
   - Или перетащи файл `login.html` в окно браузера.
   - Если при входе появятся ошибки в консоли (F12) типа «CORS» или «Failed to fetch» — тогда нужен локальный сервер. Самый простой способ один раз установить **Node.js**: https://nodejs.org (выбери LTS), установи, **перезапусти терминал**, затем снова выполни из корня проекта: `npx serve deploy/master -l 3000`.

4. В любом варианте (А или Б) в консоли должно появиться что-то вроде:

   ```
   Serving!   (или Serving HTTP on ... port 3000)
   - Local:    http://localhost:3000
   ```

   Для вариантов А и Б: сервер оставь **включённым** (не закрывай окно терминала), пока тестируешь. Адрес для браузера: **http://localhost:3000/login.html**  
   Для варианта В: просто открой `login.html` из папки `deploy\master` в браузере (в адресной строке будет `file:///...`).

---

### Шаг 2. Открыть страницу входа

1. Открой **браузер** (Chrome или другой).  
2. В адресной строке введи:

   ```
   http://localhost:3000/login.html
   ```

   и нажми Enter.  
3. Должна открыться страница с заголовком **«Вход в систему»** и полями **Email** и **Пароль**.  
   - Если страница не открылась — проверь, что в терминале запущен локальный сервер и порт 3000 свободен.  
   - Если видишь ошибку загрузки скриптов — открой консоль браузера (F12 → вкладка Console) и посмотри текст ошибки.

---

### Шаг 3. Войти

1. В поле **Email** введи тот же email, что в Supabase **Authentication** → **Users** (например `gladkovny@gmail.com`).  
2. В поле **Пароль** введи пароль этого пользователя.  
3. Нажми кнопку **«Войти»**.

**Ожидаемое поведение:**

- Кнопка может на секунду смениться на «Вход…».  
- Затем браузер **сам перейдёт** на другую страницу:  
  `http://localhost:3000/dashboard/index.html`  
  Это и есть дашборд.

**Если вместо этого:**

- Появилась красная надпись «Неверный email или пароль» — проверь email/пароль в Supabase (Authentication → Users) и что в конфиге указан именно **anon** ключ.  
- Страница «зависла» или ошибка в консоли — посмотри вкладку **Network** (F12): идёт ли запрос к `supabase.co` и какой ответ (например 401 при неверном пароле).

---

### Шаг 4. Увидеть список клиентов и выбрать клиента

Сразу после входа дашборд показывает не главный экран, а экран **«Выберите клиента»**.

1. Если в Supabase в таблице **clients** есть строки и у них **trainer_id** совпадает с твоим тренером — на странице будет **список имён**.  
2. **Нажми на одного клиента** (одну карточку).  
3. Должна загрузиться **главная страница дашборда**: вверху имя клиента, ниже карточки (блок, цели, последние тренировки, неделя и т.д.).  
   - Если данных по клиенту мало — часть блоков может быть пустой («Нет активного блока», «Нет тренировок») — это нормально.

**Если на экране «Выберите клиента» написано «Нет клиентов»:**

- Значит RLS отфильтровал так, что клиентов для твоего тренера не вернулось. Проверь шаг 0.2 (заполнен ли **auth_id** у твоего тренера в таблице **trainers**).  
- В **SQL Editor** можно выполнить запрос из раздела «Если „Нет клиентов“» в [FRONTEND_INTEGRATION.md](FRONTEND_INTEGRATION.md) и убедиться, что клиенты привязаны к тренеру с `auth_id`.

---

### Шаг 5. Понять, что ты уже «внутри» этапа

После шагов 1–4 ты по сути проверил:

- **Вход** — логин и пароль из Supabase работают, сессия сохраняется.  
- **Защита дашборда** — дашборд открылся только после входа (если бы сессии не было, тебя бы перекинуло на login).  
- **Клиенты из Supabase** — список клиентов и данные дашборда подтягиваются из Supabase (таблицы `clients`, `programs`, `workout_sessions` и т.д.).

Дополнительно можно проверить:

- В шапке дашборда есть ссылка **«Сменить клиента»** — по нажатию снова показывается список клиентов, можно выбрать другого.  
- Кнопка **шестерёнки** (настройки) → **«Выйти»** — после нажатия тебя перенаправит на страницу входа.

---

### Шаг 6. Проверить, что без входа дашборд не открывается

1. После того как ты уже залогинен, открой **новую вкладку** в браузере.  
2. Введи в адресной строке сразу адрес дашборда:

   ```
   http://localhost:3000/dashboard/index.html
   ```

   и нажми Enter.  
3. **Ожидаемое поведение:** страница на мгновение может показать «Загрузка...», после чего браузер **сам перейдёт** на  
   `http://localhost:3000/login.html`  
   (иногда с параметром `?redirect=...`). То есть без входа дашборд не показывается.

Если дашборд открылся без входа — значит проверка сессии на нём не сработала (напиши, на каком шаге это произошло).

---

## Краткий чеклист «что я сделал»

- [ ] В Supabase есть пользователь Auth (email + пароль), запомнил пароль.  
- [ ] В таблице **trainers** у моей строки заполнен **auth_id** (UUID из Authentication → Users).  
- [ ] В **deploy/master/js/supabase-config.js** указаны правильные **SUPABASE_URL** и **SUPABASE_ANON_KEY**.  
- [ ] Запустил `npx serve deploy/master -l 3000` в корне проекта.  
- [ ] Открыл в браузере `http://localhost:3000/login.html`.  
- [ ] Ввёл email и пароль, нажал «Войти» — произошёл переход на дашборд.  
- [ ] Увидел экран «Выберите клиента», выбрал клиента — загрузился дашборд с его данными.  
- [ ] Проверил «Сменить клиента» и «Выйти» — всё срабатывает.  
- [ ] В новой вкладке открыл сразу `http://localhost:3000/dashboard/index.html` — произошёл редирект на страницу входа.

Если все пункты отмечены — этап «Вход + Дашборд из Supabase» ты разобрал и проверил. Дальше можно переходить к подключению трекера и остальным шагам из [FRONTEND_INTEGRATION.md](FRONTEND_INTEGRATION.md) (раздел «Что нужно сделать дальше»).
