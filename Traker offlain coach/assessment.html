<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ğ’Ğ²Ğ¾Ğ´Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° â€” Fitness Coach</title>
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root {
            --bg: #0f0f1a;
            --card: #1a1a2e;
            --border: #2a2a4a;
            --text: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent: #a855f7;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 100px;
        }
        
        .app-header {
            background: var(--card);
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .app-title { font-size: 1.2em; font-weight: 700; color: var(--accent); }
        
        .back-btn {
            width: 36px; height: 36px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            text-decoration: none;
        }
        
        .client-selector {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1em;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2394a3b8' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 24px;
        }
        
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            margin: 12px 16px;
            border: 1px solid var(--border);
        }
        
        .card-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--accent);
            margin: 20px 16px 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        /* Grid System */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .col-full { grid-column: 1 / -1; }
        
        /* Info Items */
        .info-item {
            background: var(--bg);
            padding: 10px 12px;
            border-radius: 10px;
        }
        
        .info-label {
            font-size: 0.7em;
            color: var(--text-secondary);
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            font-size: 0.95em;
            font-weight: 500;
        }
        
        .info-value.warning { color: var(--warning); }
        .info-value.danger { color: var(--danger); }
        .info-value.success { color: var(--success); }
        .info-value.small { font-size: 0.85em; font-weight: 400; }
        
        /* Forms */
        .form-group { margin-bottom: 12px; }
        .form-label { 
            display: block; 
            font-size: 0.8em; 
            color: var(--text-secondary); 
            margin-bottom: 6px;
        }
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1em;
            font-family: inherit;
        }
        .form-input:focus, .form-textarea:focus { 
            outline: none; 
            border-color: var(--accent); 
        }
        .form-textarea { resize: vertical; min-height: 60px; }
        
        /* Rating Scale */
        .rating-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }
        
        .rating-btn {
            padding: 12px 4px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-secondary);
            border-radius: 10px;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }
        
        .rating-btn:active { transform: scale(0.95); }
        .rating-btn.active { color: white; }
        .rating-btn[data-value="1"].active { background: #ef4444; border-color: #ef4444; }
        .rating-btn[data-value="2"].active { background: #f97316; border-color: #f97316; }
        .rating-btn[data-value="3"].active { background: #eab308; border-color: #eab308; }
        .rating-btn[data-value="4"].active { background: #84cc16; border-color: #84cc16; }
        .rating-btn[data-value="5"].active { background: #22c55e; border-color: #22c55e; }
        
        /* Test Input */
        .test-row {
            display: grid;
            grid-template-columns: 1fr 44px;
            gap: 8px;
            align-items: end;
        }
        
        .x-btn {
            width: 44px; height: 44px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-secondary);
            font-size: 1.2em;
            cursor: pointer;
        }
        
        .x-btn.active {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }
        
        /* Technique with weight */
        .technique-item {
            background: var(--bg);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .technique-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .technique-name { font-size: 0.9em; }
        
        .technique-weight {
            width: 70px;
            padding: 6px 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.85em;
            text-align: center;
        }
        
        /* KBJU Card */
        .kbju-card {
            background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(59,130,246,0.1));
            border: 1px solid var(--accent);
        }
        
        .kbju-values {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            text-align: center;
        }
        
        .kbju-item {
            background: var(--bg);
            padding: 8px;
            border-radius: 8px;
        }
        
        .kbju-num { font-size: 1.1em; font-weight: 700; color: var(--accent); }
        .kbju-label { font-size: 0.7em; color: var(--text-secondary); }
        
        /* Buttons */
        .btn {
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }
        
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: var(--card); color: var(--text); border: 1px solid var(--border); }
        .btn-success { background: var(--success); color: white; }
        
        /* Alert */
        .alert {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.15);
            border-left: 3px solid #f59e0b;
            color: #fbbf24;
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.15);
            border-left: 3px solid #3b82f6;
            color: #60a5fa;
        }
        
        /* Fixed Button */
        .fixed-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(transparent, var(--bg) 20%);
            padding-top: 40px;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        @keyframes slideUp { from { transform: translate(-50%, 20px); opacity: 0; } }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .loading-content { 
            background: var(--card); 
            padding: 24px 32px; 
            border-radius: 16px; 
            text-align: center; 
        }
        .spinner { 
            width: 40px; height: 40px; 
            border: 3px solid var(--border); 
            border-top-color: var(--accent); 
            border-radius: 50%; 
            animation: spin 0.8s linear infinite; 
            margin: 0 auto 12px; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--card);
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--card);
        }
        
        .modal-title { font-size: 1.1em; font-weight: 600; }
        
        .modal-close {
            width: 32px; height: 32px;
            border: none;
            background: var(--bg);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
        }
        
        .modal-body { padding: 16px; }
        
        .modal-footer {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }
        
        .modal-footer .btn { flex: 1; }
        
        /* Summary */
        .summary-section { margin-bottom: 16px; }
        
        .summary-title {
            font-size: 0.85em;
            color: var(--accent);
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9em;
        }
        
        .summary-row:last-child { border: none; }
        
        .summary-label { color: var(--text-secondary); }
        .summary-value { font-weight: 500; }
        .summary-value.good { color: var(--success); }
        .summary-value.warn { color: var(--warning); }
        .summary-value.bad { color: var(--danger); }
        
        /* Block Form */
        .block-form {
            background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(59,130,246,0.1));
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .block-form-title {
            font-size: 1em;
            font-weight: 600;
            color: var(--success);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Category colors */
        .cat-info { border-top: 3px solid #3b82f6; }
        .cat-info .card-title { color: #3b82f6; }
        
        .cat-inbody { border-top: 3px solid #8b5cf6; }
        .cat-inbody .card-title { color: #8b5cf6; }
        
        .cat-mobility { border-top: 3px solid #f59e0b; }
        .cat-mobility .card-title { color: #f59e0b; }
        
        .cat-coordination { border-top: 3px solid #06b6d4; }
        .cat-coordination .card-title { color: #06b6d4; }
        
        .cat-strength { border-top: 3px solid #ef4444; }
        .cat-strength .card-title { color: #ef4444; }
        
        .cat-technique { border-top: 3px solid #22c55e; }
        .cat-technique .card-title { color: #22c55e; }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-row">
            <div class="app-title">ğŸ“‹ Ğ’Ğ²Ğ¾Ğ´Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°</div>
            <a href="index.html" class="back-btn">â†</a>
        </div>
        <select class="client-selector" id="clientSelector" onchange="selectClient(this.value)">
            <option value="">â€” Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° â€”</option>
        </select>
    </header>
    
    <main id="mainContent">
        <div class="card">
            <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ²Ğ²Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¾Ñ†ĞµĞ½ĞºĞ¸
            </div>
        </div>
    </main>
    
    <div class="fixed-bottom" id="saveBtn" style="display: none;">
        <button class="btn btn-primary" onclick="saveAssessment()">
            ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ†ĞµĞ½ĞºÑƒ
        </button>
    </div>
    
    <div class="loading-overlay" id="loading" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <div id="loadingText">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
        </div>
    </div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const API_URL = 'https://script.google.com/macros/s/AKfycbz5pCKFsjW3anbbor14rcMOc8snqE-R0WrsSJJWjdAgib5b-hbtTkkp8gUdFzsSfc-d/exec';

const LABELS = {
    weight_loss: 'ĞŸĞ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğµ',
    muscle_gain: 'ĞĞ°Ğ±Ğ¾Ñ€ Ğ¼Ğ°ÑÑÑ‹',
    general_fitness: 'ĞĞ±Ñ‰Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°',
    health_wellness: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ',
    strength: 'Ğ¡Ğ¸Ğ»Ğ°',
    endurance: 'Ğ’Ñ‹Ğ½Ğ¾ÑĞ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ',
    rehab: 'Ğ ĞµĞ°Ğ±Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ',
    other: 'Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ',
    none: 'ĞĞµÑ‚ Ğ¾Ğ¿Ñ‹Ñ‚Ğ°',
    less_6m: 'ĞœĞµĞ½ĞµĞµ 6 Ğ¼ĞµÑ',
    '6m_2y': '6 Ğ¼ĞµÑ â€” 2 Ğ³Ğ¾Ğ´Ğ°',
    over_2y: 'Ğ‘Ğ¾Ğ»ĞµĞµ 2 Ğ»ĞµÑ‚',
    sedentary: 'Ğ¡Ğ¸Ğ´ÑÑ‡Ğ¸Ğ¹',
    light: 'Ğ›Ñ‘Ğ³ĞºĞ°Ñ',
    moderate: 'Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ',
    active: 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ',
    very_active: 'ĞÑ‡ĞµĞ½ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ',
    '1_month': '1 Ğ¼ĞµÑÑÑ†',
    '3_months': '3 Ğ¼ĞµÑÑÑ†Ğ°',
    '6_months': '6 Ğ¼ĞµÑÑÑ†ĞµĞ²',
    '1_year': '1 Ğ³Ğ¾Ğ´',
    no_deadline: 'Ğ‘ĞµĞ· ÑÑ€Ğ¾ĞºĞ°'
};

// Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ¸Ğ· Coach Master)
const TECHNIQUE_EXERCISES = [
    { id: 'bulgarian_split', name: 'Ğ‘Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ°Ğ´', defaultReps: 5 },
    { id: 'lat_pulldown', name: 'Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ÑĞ³Ğ°', defaultReps: 8 },
    { id: 'incline_press', name: 'Ğ–Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ° (Ğ½Ğ°ĞºĞ»Ğ¾Ğ½)', defaultReps: 8 },
    { id: 'hyperextension', name: 'Ğ“Ğ¸Ğ¿ĞµÑ€ÑĞºÑÑ‚ĞµĞ½Ğ·Ğ¸Ñ', defaultReps: 10 },
    { id: 'shoulder_press', name: 'Ğ–Ğ¸Ğ¼ Ğ²Ğ²ĞµÑ€Ñ…', defaultReps: 8 }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let clients = [];
let currentClient = null;
let clientData = null;
let assessmentData = {};
let calculatedKBJU = {};
let savedAssessmentData = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.addEventListener('DOMContentLoaded', async () => {
    await loadClients();
    const clientId = new URLSearchParams(location.search).get('client') || localStorage.getItem('lastAssessmentClient');
    if (clientId) {
        document.getElementById('clientSelector').value = clientId;
        await selectClient(clientId);
    }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function apiCall(action, params = {}) {
    const url = new URL(API_URL);
    url.searchParams.set('action', action);
    Object.entries(params).forEach(([k, v]) => v != null && url.searchParams.set(k, v));
    const r = await fetch(url);
    return r.json();
}

async function apiPost(action, data) {
    const r = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, ...data })
    });
    return r.json();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLIENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadClients() {
    showLoading('Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²...');
    try {
        const res = await apiCall('getClients');
        clients = res.clients || [];
        document.getElementById('clientSelector').innerHTML = 
            '<option value="">â€” Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° â€”</option>' +
            clients.map(c => `<option value="${c.id}">${c.name} ${c.status === 'pending_assessment' ? 'âš ï¸' : ''}</option>`).join('');
    } catch (e) {
        showToast('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ' + e.message, 'error');
    }
    hideLoading();
}

async function selectClient(id) {
    if (!id) {
        currentClient = null;
        clientData = null;
        document.getElementById('mainContent').innerHTML = '<div class="card"><div style="text-align:center;padding:40px;color:var(--text-secondary)">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°</div></div>';
        document.getElementById('saveBtn').style.display = 'none';
        return;
    }
    
    currentClient = clients.find(c => c.id === id);
    localStorage.setItem('lastAssessmentClient', id);
    assessmentData = {};
    savedAssessmentData = null;
    
    showLoading('Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°...');
    try {
        const [goalsRes, profileRes, nutritionRes] = await Promise.all([
            apiCall('getGoals', { clientId: id }),
            apiCall('getClientProfile', { clientId: id }),
            apiCall('getNutrition', { clientId: id })
        ]);
        
        clientData = {
            goals: goalsRes.goals || goalsRes || {},
            profile: profileRes.profile || profileRes || {},
            nutrition: nutritionRes.nutrition || nutritionRes || {}
        };
        
    } catch (e) {
        console.error('Error loading client:', e);
        clientData = { goals: {}, profile: {}, nutrition: {} };
    }
    hideLoading();
    
    render();
    document.getElementById('saveBtn').style.display = 'block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function render() {
    const g = clientData.goals;
    const p = clientData.profile;
    const n = clientData.nutrition;
    const today = new Date().toISOString().split('T')[0];
    
    // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ»Ğ¸ Ñ†ĞµĞ»ĞµĞ¹
    const age = p.age || calcAge(g.birth_date || p.birth_date);
    const weight = parseFloat(p.weight || g.start_weight) || 0;
    const height = parseFloat(p.height || g.height) || 0;
    const gender = p.gender || g.gender || 'male';
    const bmi = height > 0 ? (weight / Math.pow(height / 100, 2)).toFixed(1) : null;
    const bmiClass = getBmiClass(bmi);
    
    // Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ
    const healthIssues = collectHealthIssues(g, p);
    
    // ĞšĞ‘Ğ–Ğ£ Ğ¸Ğ· Nutrition (ÑƒĞ¶Ğµ Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğ¹)
    calculatedKBJU = {
        calories: n.target_calories || 0,
        protein: n.target_protein || 0,
        fat: n.target_fats || 0,
        carbs: n.target_carbs || 0,
        bmr: n.BMR_final || n.BMR || 0
    };
    
    let html = `
        <!-- Ğ”Ğ°Ñ‚Ğ° Ğ¾Ñ†ĞµĞ½ĞºĞ¸ -->
        <div class="card">
            <div class="form-group" style="margin-bottom:0">
                <label class="form-label">Ğ”Ğ°Ñ‚Ğ° Ğ¾Ñ†ĞµĞ½ĞºĞ¸</label>
                <input type="date" class="form-input" id="assessDate" value="${today}">
            </div>
            ${currentClient.status === 'pending_assessment' ? 
                '<div class="alert alert-warning" style="margin-top:12px">âš ï¸ ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°. Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ°.</div>' : ''}
        </div>
        
        <!-- ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° -->
        <div class="card cat-info">
            <div class="card-title">ğŸ‘¤ ${currentClient.name}</div>
            
            <div class="grid-2" style="margin-bottom:10px">
                <div class="info-item">
                    <div class="info-label">Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚</div>
                    <div class="info-value">${age ? age + ' Ğ»ĞµÑ‚' : 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ Ğ¾ÑÑ‚</div>
                    <div class="info-value">${height ? height + ' ÑĞ¼' : 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ’ĞµÑ</div>
                    <div class="info-value">${weight ? weight + ' ĞºĞ³' : 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ˜ĞœĞ¢</div>
                    <div class="info-value ${bmiClass}">${bmi || 'â€”'}</div>
                </div>
            </div>
            
            <div class="grid-2" style="margin-bottom:10px">
                <div class="info-item">
                    <div class="info-label">Ğ¦ĞµĞ»ÑŒ</div>
                    <div class="info-value">${LABELS[g.main_goal] || g.main_goal || g.main_goal_custom || 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ¡Ñ€Ğ¾Ğº</div>
                    <div class="info-value">${LABELS[g.goal_timeframe] || g.goal_timeframe || 'â€”'}</div>
                </div>
            </div>
            
            ${g.target_weight ? `
            <div class="grid-2" style="margin-bottom:10px">
                <div class="info-item">
                    <div class="info-label">Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ²ĞµÑ</div>
                    <div class="info-value">${g.target_weight} ĞºĞ³</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ”Ğ¾ Ñ†ĞµĞ»Ğ¸</div>
                    <div class="info-value ${weight > g.target_weight ? 'warning' : 'success'}">${Math.abs(weight - g.target_weight).toFixed(1)} ĞºĞ³</div>
                </div>
            </div>
            ` : ''}
            
            <div class="grid-2" style="margin-bottom:10px">
                <div class="info-item">
                    <div class="info-label">ĞĞ¿Ñ‹Ñ‚</div>
                    <div class="info-value">${LABELS[g.training_experience] || g.training_experience || p.fitnessLevel || 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ</div>
                    <div class="info-value">${LABELS[g.activity_level] || g.activity_level || 'â€”'}</div>
                </div>
            </div>
            
            <div class="grid-2" style="margin-bottom:10px">
                <div class="info-item">
                    <div class="info-label">Ğ”Ğ½ĞµĞ¹/Ğ½ĞµĞ´ĞµĞ»Ñ</div>
                    <div class="info-value">${g.days_per_week || 'â€”'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ğ’Ñ€ĞµĞ¼Ñ</div>
                    <div class="info-value">${g.preferred_time || 'â€”'}</div>
                </div>
            </div>
            
            ${healthIssues ? `
            <div class="info-item" style="background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3);">
                <div class="info-label" style="color: var(--warning)">âš ï¸ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ</div>
                <div class="info-value warning small">${healthIssues}</div>
            </div>
            ` : ''}
        </div>
        
        <!-- Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ -->
        <div class="card">
            <div class="card-title">ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ñ‚Ñ€ĞµĞ½ĞµÑ€Ğ°</div>
            <textarea class="form-textarea" id="notes_general" rows="2" placeholder="Ğ£Ñ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ Ğ°Ğ½ĞºĞµÑ‚Ğµ, Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ°Ğ¼, Ñ†ĞµĞ»ÑĞ¼..."></textarea>
        </div>
        
        <!-- InBody -->
        <div class="section-title">ğŸ“Š Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹ InBody</div>
        <div class="card cat-inbody">
            <div class="card-title">ğŸ’ª Ğ¡Ğ¾ÑÑ‚Ğ°Ğ² Ñ‚ĞµĞ»Ğ°</div>
            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ (ĞºĞ³)</label>
                    <input type="number" class="form-input" id="inbody_weight" step="0.1" 
                           placeholder="${weight || 'â€”'}" onchange="recalcKBJU()">
                </div>
                <div class="form-group">
                    <label class="form-label">Ğ–Ğ¸Ñ€ (%)</label>
                    <input type="number" class="form-input" id="inbody_fat" step="0.1" placeholder="â€”">
                </div>
                <div class="form-group">
                    <label class="form-label">ĞœÑ‹ÑˆÑ†Ñ‹ (ĞºĞ³)</label>
                    <input type="number" class="form-input" id="inbody_muscle" step="0.1" placeholder="â€”">
                </div>
                <div class="form-group">
                    <label class="form-label">Ğ‘Ğ°Ğ·Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ°Ğ±. (ĞºĞºĞ°Ğ»)</label>
                    <input type="number" class="form-input" id="inbody_bmr" placeholder="${calculatedKBJU.bmr || 'â€”'}" onchange="recalcKBJU()">
                </div>
            </div>
            <div class="alert alert-info" style="margin-top:8px; font-size:0.8em;">
                ğŸ’¡ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ InBody Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²ÑÑ‚ Ğ»Ğ¸ÑÑ‚ Nutrition
            </div>
        </div>
        
        <!-- ĞšĞ‘Ğ–Ğ£ -->
        <div class="card kbju-card">
            <div class="card-title">ğŸ¯ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ ĞšĞ‘Ğ–Ğ£</div>
            <div class="kbju-values" id="kbjuDisplay">
                <div class="kbju-item">
                    <div class="kbju-num" id="kbju_cal">${calculatedKBJU.calories || 'â€”'}</div>
                    <div class="kbju-label">ĞºĞºĞ°Ğ»</div>
                </div>
                <div class="kbju-item">
                    <div class="kbju-num" id="kbju_p">${calculatedKBJU.protein || 'â€”'}</div>
                    <div class="kbju-label">Ğ±ĞµĞ»Ğ¾Ğº</div>
                </div>
                <div class="kbju-item">
                    <div class="kbju-num" id="kbju_f">${calculatedKBJU.fat || 'â€”'}</div>
                    <div class="kbju-label">Ğ¶Ğ¸Ñ€Ñ‹</div>
                </div>
                <div class="kbju-item">
                    <div class="kbju-num" id="kbju_c">${calculatedKBJU.carbs || 'â€”'}</div>
                    <div class="kbju-label">ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹</div>
                </div>
            </div>
        </div>
        
        <!-- Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ -->
        <div class="section-title">ğŸ‹ï¸ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ</div>
        
        <!-- ĞŸĞ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ -->
        <div class="card cat-mobility">
            <div class="card-title">ğŸ§˜ ĞŸĞ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ / Ğ“Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ</div>
            <div class="form-group">
                <label class="form-label">ĞĞ±Ñ‰Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°</label>
                <div class="rating-scale" data-key="mobility_score">
                    ${[1,2,3,4,5].map(n => `<button type="button" class="rating-btn" data-value="${n}" onclick="setRating('mobility_score',${n})">${n}</button>`).join('')}
                </div>
            </div>
            <div class="form-group" style="margin-bottom:0">
                <label class="form-label">Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸</label>
                <textarea class="form-textarea" id="mobility_notes" rows="2" placeholder="ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ, Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ½Ñ‹Ğµ Ğ·Ğ¾Ğ½Ñ‹..."></textarea>
            </div>
        </div>
        
        <!-- ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ -->
        <div class="card cat-coordination">
            <div class="card-title">ğŸ¯ ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ</div>
            <div class="form-group">
                <label class="form-label">Ğ¡ĞºĞ°ĞºĞ°Ğ»ĞºĞ° 100 Ñ€Ğ°Ğ· (ÑĞµĞºÑƒĞ½Ğ´Ñ‹)</label>
                <div class="test-row">
                    <input type="number" class="form-input" id="coordination_rope" placeholder="Ğ’Ñ€ĞµĞ¼Ñ">
                    <button type="button" class="x-btn" onclick="toggleFail('coordination_rope')">âœ•</button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">ĞĞ±Ñ‰Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°</label>
                <div class="rating-scale" data-key="coordination_score">
                    ${[1,2,3,4,5].map(n => `<button type="button" class="rating-btn" data-value="${n}" onclick="setRating('coordination_score',${n})">${n}</button>`).join('')}
                </div>
            </div>
            <div class="form-group" style="margin-bottom:0">
                <label class="form-label">Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸</label>
                <textarea class="form-textarea" id="coordination_notes" rows="2" placeholder="ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¾Ğ¼..."></textarea>
            </div>
        </div>
        
        <!-- Ğ¡Ğ¸Ğ»Ğ° -->
        <div class="card cat-strength">
            <div class="card-title">ğŸ’ª Ğ¡Ğ¸Ğ»Ğ°</div>
            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ</label>
                    <div class="test-row">
                        <input type="number" class="form-input" id="strength_pullups" placeholder="Ğ¼Ğ°ĞºÑ">
                        <button type="button" class="x-btn" onclick="toggleFail('strength_pullups')">âœ•</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ</label>
                    <div class="test-row">
                        <input type="number" class="form-input" id="strength_pushups" placeholder="Ğ¼Ğ°ĞºÑ">
                        <button type="button" class="x-btn" onclick="toggleFail('strength_pushups')">âœ•</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ĞĞ¾Ğ³Ğ¸ Ğº Ğ¿ĞµÑ€ĞµĞºĞ».</label>
                    <div class="test-row">
                        <input type="number" class="form-input" id="strength_leg_raise" placeholder="Ğ¼Ğ°ĞºÑ">
                        <button type="button" class="x-btn" onclick="toggleFail('strength_leg_raise')">âœ•</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ğ¢ÑƒĞ¼Ğ±Ğ° (ÑĞ¼)</label>
                    <div class="test-row">
                        <input type="number" class="form-input" id="strength_box_jump" placeholder="Ğ²Ñ‹ÑĞ¾Ñ‚Ğ°">
                        <button type="button" class="x-btn" onclick="toggleFail('strength_box_jump')">âœ•</button>
                    </div>
                </div>
            </div>
            <div class="form-group" style="margin-bottom:0; margin-top:8px">
                <label class="form-label">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</label>
                <textarea class="form-textarea" id="strength_notes" rows="2" placeholder="Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğµ Ğ·Ğ²ĞµĞ½ÑŒÑ..."></textarea>
            </div>
        </div>
        
        <!-- Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° -->
        <div class="card cat-technique">
            <div class="card-title">ğŸ¬ Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹</div>
            
            ${TECHNIQUE_EXERCISES.map(ex => `
                <div class="technique-item">
                    <div class="technique-header">
                        <span class="technique-name">${ex.name}</span>
                        <input type="number" class="technique-weight" id="tech_${ex.id}_weight" placeholder="ĞºĞ³">
                    </div>
                    <div class="rating-scale" data-key="tech_${ex.id}">
                        ${[1,2,3,4,5].map(n => `<button type="button" class="rating-btn" data-value="${n}" onclick="setRating('tech_${ex.id}',${n})">${n}</button>`).join('')}
                    </div>
                </div>
            `).join('')}
            
            <div class="form-group" style="margin-bottom:0; margin-top:8px">
                <label class="form-label">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞµ</label>
                <textarea class="form-textarea" id="technique_notes" rows="2" placeholder="ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¾Ğ¹..."></textarea>
            </div>
        </div>
    `;
    
    document.getElementById('mainContent').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KBJU (Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ· Nutrition, Ğ¿ĞµÑ€ĞµÑÑ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ²ĞµÑĞ°)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function recalcKBJU() {
    const n = clientData.nutrition;
    const newWeight = parseFloat(document.getElementById('inbody_weight').value);
    const newBMR = parseFloat(document.getElementById('inbody_bmr').value);
    
    if (!newWeight && !newBMR) return;
    
    // Ğ‘ĞµÑ€Ñ‘Ğ¼ ĞºĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ¸Ğ· Nutrition
    const activityMult = parseFloat(n.activity_multiplier) || 1.55;
    const deficitPct = parseFloat(n.deficit_percent) || 15;
    const proteinPerKg = parseFloat(n.protein_per_kg) || 1.8;
    const fatPerKg = parseFloat(n.fat_per_kg) || 1.0;
    
    const weight = newWeight || parseFloat(n.weight) || 70;
    const bmr = newBMR || parseFloat(n.BMR_final) || parseFloat(n.BMR) || 1500;
    
    const tdee = Math.round(bmr * activityMult);
    const calories = Math.round(tdee * (1 - deficitPct / 100));
    const protein = Math.round(weight * proteinPerKg);
    const fat = Math.round(weight * fatPerKg);
    const carbs = Math.max(50, Math.round((calories - protein * 4 - fat * 9) / 4));
    
    document.getElementById('kbju_cal').textContent = calories;
    document.getElementById('kbju_p').textContent = protein;
    document.getElementById('kbju_f').textContent = fat;
    document.getElementById('kbju_c').textContent = carbs;
    
    calculatedKBJU = { calories, protein, fat, carbs, bmr };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function calcAge(birthDate) {
    if (!birthDate) return null;
    const birth = new Date(birthDate);
    if (isNaN(birth)) return null;
    const today = new Date();
    let age = today.getFullYear() - birth.getFullYear();
    const m = today.getMonth() - birth.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
    return age;
}

function getBmiClass(bmi) {
    const val = parseFloat(bmi);
    if (isNaN(val)) return '';
    if (val < 18.5) return 'warning';
    if (val < 25) return 'success';
    if (val < 30) return 'warning';
    return 'danger';
}

function collectHealthIssues(g, p) {
    const issues = [];
    if (g.health_heart === true || g.health_heart === 'true' || g.health_heart === 'Ğ”Ğ°') issues.push('Ğ¡ĞµÑ€Ğ´Ñ†Ğµ/Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ');
    if (p.health_injuries) issues.push(p.health_injuries);
    else if (g.health_injuries_desc) issues.push(g.health_injuries_desc);
    if (p.health_chronic) issues.push(p.health_chronic);
    else if (g.health_chronic_desc) issues.push(g.health_chronic_desc);
    if (p.health_restrictions) issues.push(p.health_restrictions);
    else if (g.health_restrictions) issues.push(g.health_restrictions);
    if (g.health_medications_desc) issues.push('Ğ›ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ°: ' + g.health_medications_desc);
    return issues.filter(i => i).join('; ') || null;
}

function setRating(key, value) {
    const container = document.querySelector(`.rating-scale[data-key="${key}"]`);
    if (container) {
        container.querySelectorAll('.rating-btn').forEach(btn => 
            btn.classList.toggle('active', +btn.dataset.value === value));
    }
    assessmentData[key] = value;
}

function toggleFail(inputId) {
    const input = document.getElementById(inputId);
    const btn = input.parentElement.querySelector('.x-btn');
    if (btn.classList.contains('active')) {
        btn.classList.remove('active');
        input.disabled = false;
        input.value = '';
        delete assessmentData[inputId + '_fail'];
    } else {
        btn.classList.add('active');
        input.disabled = true;
        input.value = '';
        assessmentData[inputId + '_fail'] = true;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function saveAssessment() {
    if (!currentClient) return showToast('Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°', 'error');
    
    const date = document.getElementById('assessDate').value;
    if (!date) return showToast('Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ', 'error');
    
    // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    const data = { ...assessmentData };
    
    // Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
    ['notes_general', 'mobility_notes', 'coordination_notes', 'strength_notes', 'technique_notes'].forEach(id => {
        const el = document.getElementById(id);
        if (el && el.value.trim()) data[id] = el.value.trim();
    });
    
    // InBody
    ['inbody_weight', 'inbody_fat', 'inbody_muscle', 'inbody_bmr'].forEach(id => {
        const el = document.getElementById(id);
        if (el && el.value) data[id] = parseFloat(el.value);
    });
    
    // Ğ¡Ğ¸Ğ»Ğ¾Ğ²Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
    ['coordination_rope', 'strength_pullups', 'strength_pushups', 'strength_leg_raise', 'strength_box_jump'].forEach(id => {
        const el = document.getElementById(id);
        if (el && el.value && !el.disabled) {
            data[id] = parseFloat(el.value);
        } else if (assessmentData[id + '_fail']) {
            data[id] = 'X';
        }
    });
    
    // Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° + Ğ²ĞµÑ
    TECHNIQUE_EXERCISES.forEach(ex => {
        const key = 'tech_' + ex.id;
        const weightEl = document.getElementById(key + '_weight');
        if (weightEl && weightEl.value) data[key + '_weight'] = parseFloat(weightEl.value);
    });
    
    // ĞšĞ‘Ğ–Ğ£
    if (calculatedKBJU.calories) {
        data.kbju_calories = calculatedKBJU.calories;
        data.kbju_protein = calculatedKBJU.protein;
        data.kbju_fat = calculatedKBJU.fat;
        data.kbju_carbs = calculatedKBJU.carbs;
        data.bmr_final = calculatedKBJU.bmr;
    }
    
    if (Object.keys(data).filter(k => !k.endsWith('_fail')).length === 0) {
        return showToast('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ¾ Ğ¿Ğ¾Ğ»Ğµ', 'error');
    }
    
    // ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ´Ğ»Ñ API
    const assessments = {};
    for (const [key, value] of Object.entries(data)) {
        if (!key.endsWith('_fail')) {
            assessments[key] = {
                value: value,
                unit: getUnit(key),
                category: getCategory(key)
            };
        }
    }
    
    showLoading('Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ†ĞµĞ½ĞºĞ¸...');
    
    try {
        // 1. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Assessment
        const res = await apiPost('saveAssessment', { 
            clientId: currentClient.id, 
            date, 
            assessments 
        });
        
        if (!res.success) {
            hideLoading();
            return showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + (res.error || '?'), 'error');
        }
        
        // 2. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ClientProfile (Ğ²ĞµÑ, Ğ¶Ğ¸Ñ€, Ğ¼Ñ‹ÑˆÑ†Ñ‹)
        if (data.inbody_weight || data.inbody_fat || data.inbody_muscle) {
            const profileUpdates = {};
            if (data.inbody_weight) profileUpdates.weight = data.inbody_weight;
            if (data.inbody_fat) profileUpdates.body_fat = data.inbody_fat;
            if (data.inbody_muscle) profileUpdates.muscle_mass = data.inbody_muscle;
            
            await apiPost('updateClientProfile', {
                clientId: currentClient.id,
                updates: profileUpdates
            });
        }
        
        // 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Nutrition (inbody_bmr)
        if (data.inbody_bmr) {
            await apiPost('updateNutrition', {
                clientId: currentClient.id,
                key: 'inbody_bmr',
                value: data.inbody_bmr
            });
        }
        
        // 4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ÑĞ¸Ğ»Ğ¾Ğ²Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ² WorkoutLog ĞºĞ°Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ
        await saveWorkoutFromAssessment(date, data);
        
        hideLoading();
        
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ´Ğ»Ñ summary
        savedAssessmentData = data;
        
        // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ°Ğ¼Ğ¼Ğ°Ñ€Ğ¸
        showSummary(data, date);
        
    } catch (e) {
        hideLoading();
        showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
    }
}

/**
 * Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¸Ğ»Ğ¾Ğ²Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ² WorkoutLog
 */
async function saveWorkoutFromAssessment(date, data) {
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ ÑĞµÑÑĞ¸Ñ Ñ‚Ğ¸Ğ¿Ğ° "assessment"
    const sessionId = 'assessment_' + date;
    
    try {
        // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ Ñ Ğ²ĞµÑĞ°Ğ¼Ğ¸
        const exercises = [];
        let order = 1;
        
        TECHNIQUE_EXERCISES.forEach(ex => {
            const scoreKey = 'tech_' + ex.id;
            const weightKey = scoreKey + '_weight';
            
            if (data[scoreKey] || data[weightKey]) {
                exercises.push({
                    sessionId: sessionId,
                    order: order++,
                    exerciseId: ex.id,
                    exerciseName: ex.name,
                    category: 'assessment',
                    setNumber: 1,
                    setType: 'work',
                    weight: data[weightKey] || 0,
                    reps: ex.defaultReps,
                    technique_score: data[scoreKey] || null,
                    notes: `ĞÑ†ĞµĞ½ĞºĞ° Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸: ${data[scoreKey] || 'â€”'}/5`
                });
            }
        });
        
        if (exercises.length > 0) {
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ WorkoutSession
            await apiPost('startSession', {
                clientId: currentClient.id,
                date: date,
                type: 'assessment',
                notes: 'Ğ’Ğ²Ğ¾Ğ´Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°'
            });
            
            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ
            for (const ex of exercises) {
                await apiPost('addSet', {
                    clientId: currentClient.id,
                    ...ex
                });
            }
        }
    } catch (e) {
        console.error('Error saving workout:', e);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUMMARY MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showSummary(data, date) {
    const g = clientData.goals;
    const weight = data.inbody_weight || parseFloat(g.start_weight) || 0;
    const targetWeight = parseFloat(g.target_weight) || 0;
    const isPending = currentClient.status === 'pending_assessment';
    
    let html = `
        <div class="modal" id="summaryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¾Ñ†ĞµĞ½ĞºĞ¸</div>
                    <button class="modal-close" onclick="closeSummary(false)">Ã—</button>
                </div>
                <div class="modal-body">
                    
                    <div class="summary-section">
                        <div class="summary-title">ğŸ“ Ğ¡Ğ¾ÑÑ‚Ğ°Ğ² Ñ‚ĞµĞ»Ğ°</div>
                        ${data.inbody_weight ? `<div class="summary-row"><span class="summary-label">Ğ’ĞµÑ</span><span class="summary-value">${data.inbody_weight} ĞºĞ³</span></div>` : ''}
                        ${data.inbody_fat ? `<div class="summary-row"><span class="summary-label">Ğ–Ğ¸Ñ€</span><span class="summary-value ${data.inbody_fat > 25 ? 'warn' : 'good'}">${data.inbody_fat}%</span></div>` : ''}
                        ${data.inbody_muscle ? `<div class="summary-row"><span class="summary-label">ĞœÑ‹ÑˆÑ†Ñ‹</span><span class="summary-value">${data.inbody_muscle} ĞºĞ³</span></div>` : ''}
                        ${targetWeight && weight ? `<div class="summary-row"><span class="summary-label">Ğ”Ğ¾ Ñ†ĞµĞ»Ğ¸</span><span class="summary-value ${weight > targetWeight ? 'warn' : 'good'}">${Math.abs(weight - targetWeight).toFixed(1)} ĞºĞ³</span></div>` : ''}
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">ğŸ¯ ĞšĞ‘Ğ–Ğ£</div>
                        <div class="summary-row"><span class="summary-label">ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸</span><span class="summary-value">${calculatedKBJU.calories || 'â€”'} ĞºĞºĞ°Ğ»</span></div>
                        <div class="summary-row"><span class="summary-label">Ğ‘Ğ–Ğ£</span><span class="summary-value">${calculatedKBJU.protein || 'â€”'} / ${calculatedKBJU.fat || 'â€”'} / ${calculatedKBJU.carbs || 'â€”'}</span></div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">ğŸ‹ï¸ Ğ¢ĞµÑÑ‚Ñ‹</div>
                        ${data.mobility_score ? `<div class="summary-row"><span class="summary-label">ĞŸĞ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ</span><span class="summary-value ${getRatingClass(data.mobility_score)}">${data.mobility_score}/5</span></div>` : ''}
                        ${data.coordination_score ? `<div class="summary-row"><span class="summary-label">ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ</span><span class="summary-value ${getRatingClass(data.coordination_score)}">${data.coordination_score}/5</span></div>` : ''}
                        ${data.strength_pullups !== undefined ? `<div class="summary-row"><span class="summary-label">ĞŸĞ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ</span><span class="summary-value">${data.strength_pullups === 'X' ? 'âœ•' : data.strength_pullups}</span></div>` : ''}
                        ${data.strength_pushups !== undefined ? `<div class="summary-row"><span class="summary-label">ĞÑ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ</span><span class="summary-value">${data.strength_pushups === 'X' ? 'âœ•' : data.strength_pushups}</span></div>` : ''}
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">ğŸ¬ Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ°</div>
                        ${TECHNIQUE_EXERCISES.map(ex => {
                            const score = data['tech_' + ex.id];
                            const weight = data['tech_' + ex.id + '_weight'];
                            if (!score && !weight) return '';
                            return `<div class="summary-row">
                                <span class="summary-label">${ex.name}</span>
                                <span class="summary-value ${getRatingClass(score)}">${score || 'â€”'}/5 ${weight ? '@ ' + weight + 'ĞºĞ³' : ''}</span>
                            </div>`;
                        }).join('')}
                    </div>
                    
                    ${isPending ? `
                    <div class="block-form">
                        <div class="block-form-title">ğŸ“¦ ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº</div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº</label>
                                <input type="number" class="form-input" id="block_sessions" value="8" min="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ($)</label>
                                <input type="number" class="form-input" id="block_price" placeholder="200">
                            </div>
                        </div>
                        <div class="alert alert-info" style="margin-top:8px; font-size:0.8em;">
                            ĞŸĞ¾ÑĞ»Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° ÑÑ‚Ğ°Ğ½ĞµÑ‚ "Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹"
                        </div>
                    </div>
                    ` : ''}
                    
                </div>
                <div class="modal-footer">
                    ${isPending ? `
                        <button class="btn btn-secondary" onclick="closeSummary(false)">ĞŸĞ¾Ğ·Ğ¶Ğµ</button>
                        <button class="btn btn-success" onclick="createBlockAndActivate()">
                            âœ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±Ğ»Ğ¾Ğº
                        </button>
                    ` : `
                        <button class="btn btn-primary" onclick="closeSummary(true)">
                            âœ“ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾
                        </button>
                    `}
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', html);
}

function getRatingClass(val) {
    if (!val) return '';
    if (val >= 4) return 'good';
    if (val >= 3) return 'warn';
    return 'bad';
}

function closeSummary(reload = false) {
    document.getElementById('summaryModal')?.remove();
    if (reload) {
        location.reload();
    }
}

async function createBlockAndActivate() {
    const sessions = parseInt(document.getElementById('block_sessions').value) || 8;
    const price = parseFloat(document.getElementById('block_price').value) || 0;
    const date = document.getElementById('assessDate').value;
    
    if (sessions < 1) {
        return showToast('Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº', 'error');
    }
    
    showLoading('Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ°...');
    
    try {
        // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ±Ğ»Ğ¾Ğº (assessment ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹)
        const blockRes = await apiPost('createTrainingBlock', {
            clientId: currentClient.id,
            totalSessions: sessions,
            usedSessions: 1, // assessment = Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°
            startDate: date,
            priceUSD: price,
            notes: 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ğ¿Ñ€Ğ¸ Ğ²Ğ²Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¾Ñ†ĞµĞ½ĞºĞµ'
        });
        
        if (blockRes.success && blockRes.blockId) {
            // 2. ĞŸÑ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ assessment ÑĞµÑÑĞ¸Ñ Ğº Ğ±Ğ»Ğ¾ĞºÑƒ
            await apiPost('updateSession', {
                clientId: currentClient.id,
                sessionId: 'assessment_' + date,
                blockId: blockRes.blockId
            });
        }
        
        // 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ½Ğ° active
        await apiPost('updateClientStatus', {
            clientId: currentClient.id,
            status: 'active'
        });
        
        hideLoading();
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ
        currentClient.status = 'active';
        const opt = document.querySelector(`#clientSelector option[value="${currentClient.id}"]`);
        if (opt) opt.textContent = currentClient.name;
        
        showToast('âœ… Ğ‘Ğ»Ğ¾Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½, ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!', 'success');
        
        closeSummary(true);
        
    } catch (e) {
        hideLoading();
        showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
    }
}

function getUnit(key) {
    if (key.includes('weight') && !key.includes('kbju')) return 'ĞºĞ³';
    if (key.includes('fat')) return '%';
    if (key.includes('muscle')) return 'ĞºĞ³';
    if (key.includes('rope')) return 'ÑĞµĞº';
    if (key.includes('box_jump')) return 'ÑĞ¼';
    if (key.includes('bmr') || key.includes('calories')) return 'ĞºĞºĞ°Ğ»';
    if (key.includes('score') || key.startsWith('tech_')) return '1-5';
    return '';
}

function getCategory(key) {
    if (key.startsWith('inbody_') || key.startsWith('kbju_') || key === 'bmr_final') return 'body';
    if (key.startsWith('mobility_')) return 'mobility';
    if (key.startsWith('coordination_')) return 'coordination';
    if (key.startsWith('strength_')) return 'strength';
    if (key.startsWith('tech_')) return 'technique';
    return 'general';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showLoading(t) { 
    document.getElementById('loadingText').textContent = t; 
    document.getElementById('loading').style.display = 'flex'; 
}

function hideLoading() { 
    document.getElementById('loading').style.display = 'none'; 
}

function showToast(m, t = 'info') {
    document.querySelector('.toast')?.remove();
    const el = document.createElement('div');
    el.className = `toast ${t}`;
    el.textContent = m;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
}
</script>
</body>
</html>
